# Bunny.net Magic Container - Claude-Flow with Claude Code UI
# 
# Full-featured web interface for Claude Code with:
#   - Interactive chat
#   - File explorer & editor
#   - Git integration
#   - Session management
#   - Mobile support

version: '3.8'

services:
  claude-flow:
    build: .
    container_name: claude-flow
    environment:
      # Required
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - GH_TOKEN=${GH_TOKEN}
      
      # Git identity
      - GIT_USER_NAME=${GIT_USER_NAME:-}
      - GIT_USER_EMAIL=${GIT_USER_EMAIL:-}
      
      # Optional: Clone repo on startup
      - CLONE_REPO=${CLONE_REPO:-}
      
      # Optional: Run task on startup
      - STARTUP_TASK=${STARTUP_TASK:-}
      
      # Optional: Webhook auth (Bearer token)
      - WEBHOOK_SECRET=${WEBHOOK_SECRET:-}
      
      # Ports
      - PORT=3001
      - WEBHOOK_PORT=8080
      
      # Claude autonomous mode
      - CLAUDE_CODE_SKIP_PERMISSIONS=1
      - CLAUDE_CODE_AUTO_APPROVE=1
    ports:
      - "3001:3001"   # Claude Code UI
      - "8080:8080"   # Webhook API
    volumes:
      - claude_data:/root/.claude-flow
      - claude_config:/root/.claude
      - gh_config:/root/.config/gh
      - workspace:/workspace
    restart: unless-stopped

volumes:
  claude_data:
  claude_config:
  gh_config:
  workspace:
